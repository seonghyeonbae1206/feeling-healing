<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>안녕지수 테스트</title>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: #f5f8ff;
    }
    .page {
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      padding: 20px;
      text-align: center;
    }
    .page.active {
      display: flex;
    }
    h2 {
      font-size: 1.25rem;
      margin-bottom: 24px;
      max-width: 320px;
    }
    .circle-wrapper {
      position: relative;
      width: 300px;
      height: 180px;
      margin-top: 20px;
    }
    .circle-wrapper button {
      position: absolute;
      width: 42px;
      height: 42px;
      border-radius: 50%;
      border: 2px solid #007bff;
      background-color: white;
      color: #007bff;
      font-weight: bold;
      font-size: 14px;
      cursor: pointer;
      transition: 0.2s;
      transform: translate(-50%, -50%);
    }
    .circle-wrapper button:hover {
      background-color: #007bff;
      color: white;
    }
    .label-row {
      display: flex;
      justify-content: space-between;
      width: 300px;
      font-size: 14px;
      color: #666;
      margin-top: 8px;
    }
    .result {
      display: none;
      text-align: center;
      padding: 40px;
    }
    #result-container {
      max-width: 300px;
      margin: auto;
      background: #fff;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    #result-img {
      width: 100px;
      margin-bottom: 12px;
    }
    #result-score {
      font-size: 32px;
      font-weight: bold;
      color: #333;
      margin-bottom: 8px;
    }
    #result-title {
      font-size: 20px;
      margin-bottom: 8px;
    }
    #result-text {
      font-size: 16px;
      color: #555;
    }
    #share-btn {
      margin-top: 16px;
      padding: 10px 20px;
      font-size: 14px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="container"></div>
  <div class="result" id="result-page">
    <div id="result-container">
      <img id="result-img" src="" alt="감정 캐릭터">
      <div id="result-score"></div>
      <h2 id="result-title"></h2>
      <p id="result-text"></p>
      <button id="share-btn">결과 이미지 저장 또는 공유하기</button>
    </div>
  </div>

  <script>
    const questions = [
      "당신은 지금 당신의 삶에 얼마나 만족합니까?",
      "당신은 지금 얼마나 행복합니까?",
      "의미 있는 삶을 살고 있다고 느낍니까?",
      "당신은 지금, 얼마나 스트레스를 받고 있습니까?",
      "당신은 지금, 지루한 감정을 얼마나 느끼고 있습니까?",
      "당신은 지금, 짜증나는 감정을 얼마나 느끼고 있습니까?",
      "당신은 지금, 즐거운 감정을 얼마나 느끼고 있습니까?",
      "당신은 지금, 평안한 감정을 얼마나 느끼고 있습니까?",
      "당신은 지금, 우울한 감정을 얼마나 느끼고 있습니까?",
      "당신은 지금, 불안한 감정을 얼마나 느끼고 있습니까?"
    ];

    const posKeys = [0, 1, 2, 6, 7];
    const negKeys = [3, 4, 5, 8, 9];
    const answers = new Array(questions.length).fill(null);

    const resultProfiles = [
      {
        min: 0, max: 29,
        title: "조금 지쳐 있는 상태예요",
        text: "휴식이 필요할 수 있어요. 스스로를 돌보세요.",
        img: "https://cdn-icons-png.flaticon.com/512/742/742760.png"
      },
      {
        min: 30, max: 39,
        title: "조금 지쳤지만, 잘 해내고 있어요.",
        text: "마음을 돌아보며 한 걸음씩 나아가 보세요.",
        img: "https://cdn-icons-png.flaticon.com/512/742/742758.png"
      },
      {
        min: 40, max: 50,
        title: "감정 밸런스를 잘 유지하고 있어요.",
        text: "지금처럼 잘 해내고 있어요. 스스로를 칭찬해주세요.",
        img: "https://cdn-icons-png.flaticon.com/512/742/742790.png"
      }
    ];

    const container = document.getElementById("container");

    questions.forEach((q, i) => {
      const page = document.createElement("div");
      page.className = "page";
      if (i === 0) page.classList.add("active");
      page.innerHTML = `<h2>${q}</h2>`;

      const wrapper = document.createElement("div");
      wrapper.className = "circle-wrapper";

      const total = 11;
      const radius = 120;
      const centerX = 150;
      const centerY = 140;

      for (let j = 0; j < total; j++) {
        const angle = Math.PI * (1 + j / (total - 1));
        const x = centerX + radius * Math.cos(angle);
        const y = centerY + radius * Math.sin(angle);

        const btn = document.createElement("button");
        btn.textContent = j;
        btn.style.left = `${x}px`;
        btn.style.top = `${y}px`;
        btn.onclick = () => {
          answers[i] = j;
          document.querySelectorAll(".page")[i].classList.remove("active");
          if (i + 1 < questions.length) {
            document.querySelectorAll(".page")[i + 1].classList.add("active");
          } else {
            showResult();
          }
        };
        wrapper.appendChild(btn);
      }

      page.appendChild(wrapper);

      const labelRow = document.createElement("div");
      labelRow.className = "label-row";
      labelRow.innerHTML = `<span>전혀 느끼지 않는다</span><span>매우 많이 느끼고 있다</span>`;
      page.appendChild(labelRow);

      container.appendChild(page);
    });

    function calculateScore() {
      let pos = 0, neg = 0;
      posKeys.forEach(i => pos += answers[i]);
      negKeys.forEach(i => neg += (10 - answers[i]));
      return pos + neg;
    }

    function showResult() {
      const score = calculateScore();
      const result = resultProfiles.find(r => score >= r.min && score <= r.max);

      document.getElementById("result-page").style.display = "block";
      document.getElementById("result-score").innerText = score;
      document.getElementById("result-title").innerText = result.title;
      document.getElementById("result-text").innerText = result.text;
      document.getElementById("result-img").src = result.img;
    }

    document.getElementById("share-btn").addEventListener("click", () => {
      html2canvas(document.getElementById("result-container")).then(canvas => {
        canvas.toBlob(blob => {
          if (navigator.share && navigator.canShare({ files: [new File([blob], "result.png", { type: blob.type })] })) {
            const file = new File([blob], "result.png", { type: blob.type });
            navigator.share({ files: [file], title: "내 안녕지수 결과" });
          } else {
            const link = document.createElement("a");
            link.download = "result.png";
            link.href = canvas.toDataURL();
            link.click();
          }
        });
      });
    });
  </script>
</body>
</html>
